# Распределённый вычислитель арифметических выражений

## Описание
Данный проект реализует распределённую систему вычисления арифметических выражений. Выражения обрабатываются сервером (оркестратором), который разбивает их на отдельные математические операции и распределяет их среди агентов (вычислительных узлов). Агенты выполняют операции и возвращают результаты на сервер.

## Компоненты
### 1. Оркестратор
Оркестратор принимает арифметические выражения, разбивает их на отдельные задачи, распределяет среди агентов и собирает результаты.

#### API оркестратора

- **Добавление выражения**
  ```bash
  curl --location 'localhost/api/v1/calculate' \
  --header 'Content-Type: application/json' \
  --data '{"expression": "2 + 3 * 4"}'
  ```
  **Ответ:**
  ```json
  {
      "id": "expr-123456789"
  }
  ```

- **Получение списка выражений**
  ```bash
  curl --location 'localhost/api/v1/expressions'
  ```
  **Ответ:**
  ```json
  {
      "expressions": [
          {
              "id": "expr-123456789",
              "status": "pending",
              "result": 0.0
          }
      ]
  }
  ```

- **Получение выражения по ID**
  ```bash
  curl --location 'localhost/api/v1/expressions/expr-123456789'
  ```
  **Ответ:**
  ```json
  {
      "expression": {
          "id": "expr-123456789",
          "status": "done",
          "result": 14.0
      }
  }
  ```

- **Получение задачи для выполнения**
  ```bash
  curl --location 'localhost/internal/task'
  ```
  **Ответ:**
  ```json
  {
      "task": {
          "id": "task-987654321",
          "arg1": 3.0,
          "arg2": 4.0,
          "operation": "*",
          "operation_time": 1000
      }
  }
  ```

- **Отправка результата вычисления**
  ```bash
  curl --location 'localhost/internal/task' \
  --header 'Content-Type: application/json' \
  --data '{"id": "task-987654321", "result": 12.0}'
  ```

### 2. Агент
Агент получает задачи, выполняет их и отправляет результаты обратно в оркестратор. Количество параллельных вычислений регулируется переменной среды `COMPUTING_POWER`.

#### Логика работы агента:
1. Запрашивает задачу у оркестратора (`GET /internal/task`).
2. Выполняет вычисление (эмулируя задержку в соответствии с переменными среды `TIME_*`).
3. Отправляет результат обратно (`POST /internal/task`).
4. Повторяет процесс в бесконечном цикле.

## Переменные среды
| Переменная             | Описание                                    | Значение по умолчанию |
|------------------------|---------------------------------------------|-----------------------|
| `COMPUTING_POWER`      | Количество параллельных агентов             | `2`                   |
| `TIME_ADDITION_MS`     | Время выполнения сложения (мс)             | `1000`                |
| `TIME_SUBTRACTION_MS`  | Время выполнения вычитания (мс)            | `1000`                |
| `TIME_MULTIPLICATIONS_MS` | Время выполнения умножения (мс)         | `1000`                |
| `TIME_DIVISIONS_MS`    | Время выполнения деления (мс)              | `1000`                |

## Запуск проекта
### 1. Запуск оркестратора
```bash
 go run cmd/orchestrator/main.go
```

### 2. Запуск агента
```bash
COMPUTING_POWER=2 go run cmd/agent/main.go
```

## Примеры использования
1. Отправить выражение `2 + 3 * 4` на вычисление.
2. Оркестратор разобьёт его на `3 * 4`, отправит задачу агенту.
3. Агент выполнит `3 * 4`, вернёт `12`.
4. Оркестратор обработает `2 + 12`, создаст новую задачу.
5. Агент выполнит `2 + 12`, вернёт `14`.
6. Оркестратор сохранит результат и установит статус `done`.
7. Клиент получит `14` при запросе `/api/v1/expressions/{id}`.

## Лицензия
MIT

